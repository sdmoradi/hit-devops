on:
  push:
    branches:
      - "master"
jobs:
  automation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: diff-requirements
        shell: bash
        run : |
          # Diff HEAD with the previous commit
          diff=$(git diff HEAD^ HEAD --name-only)
          SourceDiff=$(echo $diff | grep "requirements.txt" | wc -l)
      - name: set-env
        run : echo "req_changed=$SourceDiff" >> $GITHUB_ENV
      - name : change-major
        if: ${{env.req_changed}} == 'True'
        run: cat version.txt | awk '{split($0,a,"."); print a[1]+1 "." a[2] "." a[3]}' | tee version.txt
      - name: change-commit-push
        if: ${{env.req_changed}} == 'True'
        run: |
          git config --global user.name "sdmoradi"
          git config --global user.email "sdmrd67@gmail.com"
          git add version.txt
          git commit -m "change patch version"
          git push
